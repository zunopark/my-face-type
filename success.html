<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê²°ì œ ì„±ê³µ</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 40px;
    }
    .success { font-size: 20px; color: green; }
    .fail { font-size: 20px; color: red; }
  </style>
</head>
<body>
  <h2 id="status">ğŸ”„ ê²°ì œ í™•ì¸ ì¤‘...</h2>
  <p>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</p>

  <script>
    const params = new URLSearchParams(window.location.search);
    const paymentKey = params.get("paymentKey");
    const orderId = params.get("orderId");
    const amount = Number(params.get("amount"));
    const resultId = params.get("id");

    const body = {
      paymentKey,
      orderId,
      amount
    };

    fetch("https://port-0-momzzi-fastapi-m7ynssht4601229b.sel4.cloudtype.app/payment/confirm", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    })
    .then(res => {
      if (!res.ok) throw new Error("ì„œë²„ ê²€ì¦ ì‹¤íŒ¨");
      return res.json();
    })
    .then(data => {
      console.log("âœ… ê²°ì œ í™•ì¸ ì™„ë£Œ", data);
      document.getElementById("status").textContent = "âœ… ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!";
      document.getElementById("status").className = "success";

      localStorage.setItem("paymentComplete", "true");
      
      if (resultId) {
        localStorage.setItem("paidResultId", resultId);
        setTimeout(() => {
          window.location.href = `/result.html?id=${resultId}`;
        }, 2000);
      } else {
        setTimeout(() => {
          window.location.href = "/";
        }, 2000);
      }
    })
    .catch(err => {
      console.error("âŒ ê²°ì œ í™•ì¸ ì‹¤íŒ¨", err);
      document.getElementById("status").textContent = "âŒ ê²°ì œ í™•ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
      document.getElementById("status").className = "fail";

      setTimeout(() => {
        window.location.href = "/fail.html";
      }, 3000);
    });
  </script>
</body>
</html>
